{"update_time":"2019-02-26T16:16:46.494Z","content":{"html":"<div data-block-id=\"805a8c1d-f0e6-499f-8589-167771b9b62c\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 2px; margin-bottom: 1px; color: rgb(55, 53, 47);\"><div style=\"display: flex; width: 100%; font-weight: 600; font-size: 1.5em; letter-spacing: -0.002em; line-height: 1.2; color: rgb(55, 53, 47);\"><div contenteditable=\"false\" spellcheck=\"true\" placeholder=\"Heading 2\" data-root=\"true\" style=\"max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;\">起因</div></div></div><div data-block-id=\"ca07ff05-4287-4f8f-8caa-1dd97b440cce\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 1px; margin-bottom: 1px;\"><div style=\"color: rgb(55, 53, 47);\"><div style=\"display: flex;\"><div contenteditable=\"false\" spellcheck=\"true\" placeholder=\" \" data-root=\"true\" style=\"max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;\">要做一个统一的log模块，用来存储模型实例的变更记录。既然是log，就要知道是谁操作的。在django中分为view层和model层。在view层面可以很方面的获取到request信息，但是在model层是获取不到。</div></div></div></div><div data-block-id=\"bc173bbb-43e8-40e9-a215-9df55aedfee9\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 1px; margin-bottom: 1px;\"><div style=\"color: rgb(55, 53, 47);\"><div style=\"display: flex;\"><div contenteditable=\"false\" spellcheck=\"true\" placeholder=\" \" data-root=\"true\" style=\"max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;\">搜索了一番，发现了很做骚操作，记录一下并简要的</div></div></div></div><div data-block-id=\"255ad602-7635-4332-a693-da44b9eb9c89\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 1px; margin-bottom: 1px;\"><div style=\"color: rgb(55, 53, 47);\"><div style=\"display: flex;\"><div contenteditable=\"false\" spellcheck=\"true\" placeholder=\" \" data-root=\"true\" style=\"max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;\">关键词: <span style=\"font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;line-height:normal;background:rgba(135,131,120,0.15);color:#EB5757;border-radius:3px;font-size:85%;padding:0.2em 0.4em\" data-token-index=\"1\">django get current user in model/signal</span></div></div></div></div><div data-block-id=\"6429b80d-9fac-48b3-84cb-01b48b01b414\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 1px; margin-bottom: 1px;\"><div style=\"color: rgb(55, 53, 47);\"><div style=\"display: flex;\"><div contenteditable=\"false\" spellcheck=\"true\" placeholder=\" \" data-root=\"true\" style=\"max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; min-height: 1em; color: rgb(55, 53, 47); -webkit-text-fill-color: rgba(55, 53, 47, 0.4);\"></div></div></div></div><div data-block-id=\"3ffb2f18-56eb-4d57-9e34-6f49c895a654\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 1em; margin-bottom: 1px; color: rgb(55, 53, 47);\"><div style=\"display: flex; width: 100%; font-weight: 600; font-size: 1.5em; letter-spacing: -0.002em; line-height: 1.2; color: rgb(55, 53, 47);\"><div contenteditable=\"false\" spellcheck=\"true\" placeholder=\"Heading 2\" data-root=\"true\" style=\"max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;\">方法一</div></div></div><div data-block-id=\"81457378-a72a-4d77-90f5-9adfb881ba67\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 1px; margin-bottom: 1px;\"><div style=\"color: rgb(55, 53, 47);\"><div style=\"display: flex;\"><div contenteditable=\"false\" spellcheck=\"true\" placeholder=\" \" data-root=\"true\" style=\"max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;\">也是最常见的方法，中间件中获取request信息，保存在当前线程中</div></div></div></div><div data-block-id=\"ff31a33a-daea-4735-9eae-baa4a89121cb\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 4px; margin-bottom: 4px;\"><div style=\"display: flex;\"><div style=\"flex-grow: 1; border-radius: 3px; text-align: left; position: relative; background: rgb(247, 246, 243); width: 100%;\"><div class=\"line-numbers notion-code-block\" style=\"display: flex;\"><div contenteditable=\"false\" spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" data-root=\"true\" style=\"flex-grow: 1; flex-shrink: 1; min-width: 1px; text-align: left; font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 85%; tab-size: 2; padding: 30px 16px 30px 20px; min-height: 1em; color: rgb(55, 53, 47); white-space: pre; overflow-x: auto;\"><span class=\"token keyword\">from</span> threading <span class=\"token keyword\">import</span> current_thread\n\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span>deprecation <span class=\"token keyword\">import</span> MiddlewareMixin\n\n\n_requests <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">current_request</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> _requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>current_thread<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>ident<span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">RequestMiddleware</span><span class=\"token punctuation\">(</span>MiddlewareMixin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">process_request</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        _requests<span class=\"token punctuation\">[</span>current_thread<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>ident<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> request\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">process_response</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># when response is ready, request should be flushed</span>\n        _requests<span class=\"token punctuation\">.</span>pop<span class=\"token punctuation\">(</span>current_thread<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>ident<span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> response\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">process_exception</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> exception<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># if an exception has happened, request should be flushed too</span>\n         _requests<span class=\"token punctuation\">.</span>pop<span class=\"token punctuation\">(</span>current_thread<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>ident<span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span><span>\n</span></div></div><div style=\"position: absolute; top: 0px; right: 0px; color: rgba(55, 53, 47, 0.6); display: flex; align-items: center; justify-content: flex-end; height: 30px;\"></div><div style=\"position: absolute; bottom: 0px; right: 0px; color: rgba(55, 53, 47, 0.6); display: flex; align-items: center; justify-content: flex-end; height: 30px;\"><div style=\"cursor: default; user-select: none; transition: background 120ms ease-in 0s; display: inline-flex; align-items: center; white-space: nowrap; height: 20px; border-radius: 3px; font-size: 12px; line-height: 1.2; padding-left: 5px; padding-right: 5px; color: rgba(55, 53, 47, 0.6); margin-right: 5px;\">Python<svg viewBox=\"0 0 30 30\" style=\"width: 10px; height: 100%; display: block; fill: rgba(55, 53, 47, 0.3); flex-shrink: 0; backface-visibility: hidden; margin-left: 4px;\"><polygon points=\"15,17.4 4.8,7 2,9.8 15,23 28,9.8 25.2,7 \"></polygon></svg></div></div></div></div></div><div data-block-id=\"0e94fdf4-e60d-48c7-9a5e-a605b99049e7\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 1px; margin-bottom: 1px;\"><div style=\"color: rgb(55, 53, 47);\"><div style=\"display: flex;\"><div contenteditable=\"false\" spellcheck=\"true\" placeholder=\" \" data-root=\"true\" style=\"max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; min-height: 1em; color: rgb(55, 53, 47); -webkit-text-fill-color: rgba(55, 53, 47, 0.4);\"></div></div></div></div><div data-block-id=\"612611de-b1b7-408b-b70b-c0abab8146fd\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 1px; margin-bottom: 1px;\"><div style=\"color: rgb(55, 53, 47);\"><div style=\"display: flex;\"><div contenteditable=\"false\" spellcheck=\"true\" placeholder=\" \" data-root=\"true\" style=\"max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;\">参见</div></div></div></div><div data-block-id=\"5ca78a96-2cea-46ff-bc48-cae6dc1b66bd\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 4px; margin-bottom: 4px;\"><div><div style=\"display: flex;\"><div class=\"notion-cursor-default\" style=\"display: flex; flex-wrap: wrap-reverse; align-items: stretch; text-align: left; overflow: hidden; border: 1px solid rgba(55, 53, 47, 0.16); border-radius: 3px; position: relative; flex-grow: 1; color: rgb(55, 53, 47);\"><div style=\"flex: 4 1 180px; min-height: 60px; overflow: hidden; text-align: left;\"><a href=\"https://stackoverflow.com/a/36328564/5808718\" target=\"_blank\" rel=\"noopener noreferrer nofollow\" style=\"display: block; color: inherit; text-decoration: none; height: 100%;\"><div style=\"cursor: pointer; user-select: none; transition: background 120ms ease-in 0s; width: 100%; display: block; padding: 14px; height: 100%;\"><div style=\"font-size: 14px; line-height: 20px; max-height: 20px; overflow: hidden;\">Django: Get current user in model save</div><div style=\"font-size: 12px; line-height: 16px; color: rgba(55, 53, 47, 0.6); max-height: 32px; overflow: hidden;\">I want to get current logged in user(request.user) in save method of models.py. I want to check the role of the user and perform some operations based on his role. I have given the models.py code b...</div><div style=\"font-size: 12px; line-height: 16px; display: flex; overflow: hidden; margin-top: 4px;\"><img src=\"https://cdn.sstatic.net/Sites/stackoverflow/img/favicon.ico?v=4f32ecc8f43d\" style=\"width: 16px; height: 16px; min-width: 16px; margin-right: 4px;\"><div style=\"min-width: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;\">https://stackoverflow.com/a/36328564/5808718</div></div></div></a></div><div style=\"flex: 1 1 180px; min-height: 80px; display: block; position: relative;\"><div style=\"position: absolute; top: 0px; left: 0px; right: 0px; bottom: 0px;\"><div style=\"width: 100%; height: 100%;\"><img src=\"https://www.notion.so/image/https%3A%2F%2Fcdn.sstatic.net%2FSites%2Fstackoverflow%2Fimg%2Fapple-touch-icon%402.png%3Fv%3D73d79a89bded?width=500\" style=\"display: block; object-fit: cover; border-radius: 1px; width: 100%; height: 100%;\"></div></div></div></div></div></div></div><div data-block-id=\"a6301c2a-17f6-4af7-aad3-9b5dc2a605b6\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 1px; margin-bottom: 1px;\"><div style=\"color: rgb(55, 53, 47);\"><div style=\"display: flex;\"><div contenteditable=\"false\" spellcheck=\"true\" placeholder=\" \" data-root=\"true\" style=\"max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; min-height: 1em; color: rgb(55, 53, 47); -webkit-text-fill-color: rgba(55, 53, 47, 0.4);\"></div></div></div></div><div data-block-id=\"d93dfaa6-a3e5-4c70-b5fa-4e16b3964c2a\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 1em; margin-bottom: 1px; color: rgb(55, 53, 47);\"><div style=\"display: flex; width: 100%; font-weight: 600; font-size: 1.5em; letter-spacing: -0.002em; line-height: 1.2; color: rgb(55, 53, 47);\"><div contenteditable=\"false\" spellcheck=\"true\" placeholder=\"Heading 2\" data-root=\"true\" style=\"max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;\">方法二</div></div></div><div data-block-id=\"310884e0-e40d-4f4b-ba9d-613ff4a1a57d\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 1px; margin-bottom: 1px;\"><div style=\"color: rgb(55, 53, 47);\"><div style=\"display: flex;\"><div contenteditable=\"false\" spellcheck=\"true\" placeholder=\" \" data-root=\"true\" style=\"max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;\">在pre_save的时候，从堆栈信息中信息中获取request对象。</div></div></div></div><div data-block-id=\"0d00becb-b9f3-4912-bc21-53a82682514a\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 1px; margin-bottom: 1px;\"><div style=\"color: rgb(55, 53, 47);\"><div style=\"display: flex;\"><div contenteditable=\"false\" spellcheck=\"true\" placeholder=\" \" data-root=\"true\" style=\"max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; min-height: 1em; color: rgb(55, 53, 47); -webkit-text-fill-color: rgba(55, 53, 47, 0.4);\"></div></div></div></div><div data-block-id=\"b6e74d19-6206-4b57-8ac9-eefbed550f14\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 4px; margin-bottom: 4px;\"><div style=\"display: flex;\"><div style=\"flex-grow: 1; border-radius: 3px; text-align: left; position: relative; background: rgb(247, 246, 243); width: 100%;\"><div class=\"line-numbers notion-code-block\" style=\"display: flex;\"><div contenteditable=\"false\" spellcheck=\"false\" autocorrect=\"off\" autocapitalize=\"off\" data-root=\"true\" style=\"flex-grow: 1; flex-shrink: 1; min-width: 1px; text-align: left; font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 85%; tab-size: 2; padding: 30px 16px 30px 20px; min-height: 1em; color: rgb(55, 53, 47); white-space: pre; overflow-x: auto;\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>db<span class=\"token punctuation\">.</span>models<span class=\"token punctuation\">.</span>signals <span class=\"token keyword\">import</span> pre_save\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>dispatch <span class=\"token keyword\">import</span> receiver\n\n@receiver<span class=\"token punctuation\">(</span>pre_save<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">my_callback</span><span class=\"token punctuation\">(</span>sender<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">import</span> inspect\n    <span class=\"token keyword\">for</span> frame_record <span class=\"token keyword\">in</span> inspect<span class=\"token punctuation\">.</span>stack<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> frame_record<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">==</span><span class=\"token string\">'get_response'</span><span class=\"token punctuation\">:</span>\n            request <span class=\"token operator\">=</span> frame_record<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>f_locals<span class=\"token punctuation\">[</span><span class=\"token string\">'request'</span><span class=\"token punctuation\">]</span>\n            <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        request <span class=\"token operator\">=</span> <span class=\"token boolean\">None</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span>\n</span></div></div><div style=\"position: absolute; top: 0px; right: 0px; color: rgba(55, 53, 47, 0.6); display: flex; align-items: center; justify-content: flex-end; height: 30px;\"></div><div style=\"position: absolute; bottom: 0px; right: 0px; color: rgba(55, 53, 47, 0.6); display: flex; align-items: center; justify-content: flex-end; height: 30px;\"><div style=\"cursor: default; user-select: none; transition: background 120ms ease-in 0s; display: inline-flex; align-items: center; white-space: nowrap; height: 20px; border-radius: 3px; font-size: 12px; line-height: 1.2; padding-left: 5px; padding-right: 5px; color: rgba(55, 53, 47, 0.6); margin-right: 5px;\">Python<svg viewBox=\"0 0 30 30\" style=\"width: 10px; height: 100%; display: block; fill: rgba(55, 53, 47, 0.3); flex-shrink: 0; backface-visibility: hidden; margin-left: 4px;\"><polygon points=\"15,17.4 4.8,7 2,9.8 15,23 28,9.8 25.2,7 \"></polygon></svg></div></div></div></div></div><div data-block-id=\"ac30b196-25b7-4d2f-94f7-484e7ac626e5\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 1px; margin-bottom: 1px;\"><div style=\"color: rgb(55, 53, 47);\"><div style=\"display: flex;\"><div contenteditable=\"false\" spellcheck=\"true\" placeholder=\" \" data-root=\"true\" style=\"max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;\">参见</div></div></div></div><div data-block-id=\"5766ad57-0e36-48e6-b640-2101a561fd2d\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 4px; margin-bottom: 4px;\"><div><div style=\"display: flex;\"><div class=\"notion-cursor-default\" style=\"display: flex; flex-wrap: wrap-reverse; align-items: stretch; text-align: left; overflow: hidden; border: 1px solid rgba(55, 53, 47, 0.16); border-radius: 3px; position: relative; flex-grow: 1; color: rgb(55, 53, 47);\"><div style=\"flex: 4 1 180px; min-height: 60px; overflow: hidden; text-align: left;\"><a href=\"https://stackoverflow.com/a/8874383\" target=\"_blank\" rel=\"noopener noreferrer nofollow\" style=\"display: block; color: inherit; text-decoration: none; height: 100%;\"><div style=\"cursor: pointer; user-select: none; transition: background 120ms ease-in 0s; width: 100%; display: block; padding: 14px; height: 100%;\"><div style=\"font-size: 14px; line-height: 20px; max-height: 20px; overflow: hidden;\">Get current user log in signal in Django</div><div style=\"font-size: 12px; line-height: 16px; color: rgba(55, 53, 47, 0.6); max-height: 32px; overflow: hidden;\">I am just using the admin site in Django. I have 2 Django signals (pre_save and post_save). I would like to have the username of the current user. How would I do that? It does not seem I can send a</div><div style=\"font-size: 12px; line-height: 16px; display: flex; overflow: hidden; margin-top: 4px;\"><img src=\"https://cdn.sstatic.net/Sites/stackoverflow/img/favicon.ico?v=4f32ecc8f43d\" style=\"width: 16px; height: 16px; min-width: 16px; margin-right: 4px;\"><div style=\"min-width: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;\">https://stackoverflow.com/a/8874383</div></div></div></a></div><div style=\"flex: 1 1 180px; min-height: 80px; display: block; position: relative;\"><div style=\"position: absolute; top: 0px; left: 0px; right: 0px; bottom: 0px;\"><div style=\"width: 100%; height: 100%;\"><img src=\"https://www.notion.so/image/https%3A%2F%2Fcdn.sstatic.net%2FSites%2Fstackoverflow%2Fimg%2Fapple-touch-icon%402.png%3Fv%3D73d79a89bded?width=500\" style=\"display: block; object-fit: cover; border-radius: 1px; width: 100%; height: 100%;\"></div></div></div></div></div></div></div><div data-block-id=\"b172d7ad-3178-4700-ad74-e21bac515aba\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 1px; margin-bottom: 1px;\"><div style=\"color: rgb(55, 53, 47);\"><div style=\"display: flex;\"><div contenteditable=\"false\" spellcheck=\"true\" placeholder=\" \" data-root=\"true\" style=\"max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; min-height: 1em; color: rgb(55, 53, 47); -webkit-text-fill-color: rgba(55, 53, 47, 0.4);\"></div></div></div></div><div data-block-id=\"6f0cb5ce-ae2b-4eea-8d92-8dcd2f236c84\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 1px; margin-bottom: 1px;\"><div style=\"color: rgb(55, 53, 47);\"><div style=\"display: flex;\"><div contenteditable=\"false\" spellcheck=\"true\" placeholder=\" \" data-root=\"true\" style=\"max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; min-height: 1em; color: rgb(55, 53, 47); -webkit-text-fill-color: rgba(55, 53, 47, 0.4);\"></div></div></div></div><div data-block-id=\"34d4044a-5c09-4fd3-83fc-75c4cfa18ff6\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 1em; margin-bottom: 1px; color: rgb(55, 53, 47);\"><div style=\"display: flex; width: 100%; font-weight: 600; font-size: 1.5em; letter-spacing: -0.002em; line-height: 1.2; color: rgb(55, 53, 47);\"><div contenteditable=\"false\" spellcheck=\"true\" placeholder=\"Heading 2\" data-root=\"true\" style=\"max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;\">方法三</div></div></div><div data-block-id=\"e8a3a777-b3e6-4d24-a858-6038a68bb160\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 1px; margin-bottom: 1px;\"><div style=\"color: rgb(55, 53, 47);\"><div style=\"display: flex;\"><div contenteditable=\"false\" spellcheck=\"true\" placeholder=\" \" data-root=\"true\" style=\"max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;\">单例</div></div></div></div><div data-block-id=\"9f634db2-44dc-44b8-9fc8-478397f5979c\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 1px; margin-bottom: 1px;\"><div style=\"color: rgb(55, 53, 47);\"><div style=\"display: flex;\"><div contenteditable=\"false\" spellcheck=\"true\" placeholder=\" \" data-root=\"true\" style=\"max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px;\">中间件中获取到请求用户，存储在单例中。线程安全？？？</div></div></div></div><div data-block-id=\"14b2bcb1-f521-4556-a259-08694be369f4\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 4px; margin-bottom: 4px;\"><div><div style=\"display: flex;\"><div class=\"notion-cursor-default\" style=\"display: flex; flex-wrap: wrap-reverse; align-items: stretch; text-align: left; overflow: hidden; border: 1px solid rgba(55, 53, 47, 0.16); border-radius: 3px; position: relative; flex-grow: 1; color: rgb(55, 53, 47);\"><div style=\"flex: 4 1 180px; min-height: 60px; overflow: hidden; text-align: left;\"><a href=\"https://stackoverflow.com/a/7469395\" target=\"_blank\" rel=\"noopener noreferrer nofollow\" style=\"display: block; color: inherit; text-decoration: none; height: 100%;\"><div style=\"cursor: pointer; user-select: none; transition: background 120ms ease-in 0s; width: 100%; display: block; padding: 14px; height: 100%;\"><div style=\"font-size: 14px; line-height: 20px; max-height: 20px; overflow: hidden;\">Get current user log in signal in Django</div><div style=\"font-size: 12px; line-height: 16px; color: rgba(55, 53, 47, 0.6); max-height: 32px; overflow: hidden;\">I am just using the admin site in Django. I have 2 Django signals (pre_save and post_save). I would like to have the username of the current user. How would I do that? It does not seem I can send a</div><div style=\"font-size: 12px; line-height: 16px; display: flex; overflow: hidden; margin-top: 4px;\"><img src=\"https://cdn.sstatic.net/Sites/stackoverflow/img/favicon.ico?v=4f32ecc8f43d\" style=\"width: 16px; height: 16px; min-width: 16px; margin-right: 4px;\"><div style=\"min-width: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;\">https://stackoverflow.com/a/7469395</div></div></div></a></div><div style=\"flex: 1 1 180px; min-height: 80px; display: block; position: relative;\"><div style=\"position: absolute; top: 0px; left: 0px; right: 0px; bottom: 0px;\"><div style=\"width: 100%; height: 100%;\"><img src=\"https://www.notion.so/image/https%3A%2F%2Fcdn.sstatic.net%2FSites%2Fstackoverflow%2Fimg%2Fapple-touch-icon%402.png%3Fv%3D73d79a89bded?width=500\" style=\"display: block; object-fit: cover; border-radius: 1px; width: 100%; height: 100%;\"></div></div></div></div></div></div></div><div data-block-id=\"e60881e8-1881-4e08-a6ea-511a6c6e5ce6\" class=\"notion-selectable\" style=\"width: 100%; margin-top: 1px; margin-bottom: 0px;\"><div style=\"color: rgb(55, 53, 47);\"><div style=\"display: flex;\"><div contenteditable=\"false\" spellcheck=\"true\" placeholder=\" \" data-root=\"true\" style=\"max-width: 100%; width: 100%; white-space: pre-wrap; word-break: break-word; caret-color: rgb(55, 53, 47); padding: 3px 2px; min-height: 1em; color: rgb(55, 53, 47); -webkit-text-fill-color: rgba(55, 53, 47, 0.4);\"></div></div></div></div>","brief":"起因\n要做一个统一的log模块，用来存储模型实例的变更记录。既然是log，就要知道是谁操作的。在django中分为view层和model层。在view层面可以很方面的获取到request信息，但是在m"}}